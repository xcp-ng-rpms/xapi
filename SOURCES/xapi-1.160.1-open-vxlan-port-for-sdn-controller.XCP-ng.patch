Author: benjamreis <benjamin.reis@vates.fr>
Date:   Tue Jun 25 11:16:55 2019 +0200

    Open VxLAN port for SDN controller

    Signed-off-by: benjamreis <benjamin.reis@vates.fr>

diff --git a/scripts/plugins/openvswitch-config-update b/scripts/plugins/openvswitch-config-update
index c3bcfe1ce..9f8a39b85 100755
--- a/scripts/plugins/openvswitch-config-update
+++ b/scripts/plugins/openvswitch-config-update
@@ -74,6 +74,8 @@ def update(session, args):
         delete_cacert()
         cmd = [iptablectl, 'close', '6640']
         output = subprocess.Popen(cmd, stdout=subprocess.PIPE).communicate()
+        cmd = [iptablectl, 'close', '4789', 'udp']
+        output = subprocess.Popen(cmd, stdout=subprocess.PIPE).communicate()
         try:
             emergency_reset(session, None)
         except:
@@ -246,6 +248,9 @@ def setControllerCfg(bootstrap, controller):
                        '/etc/xensource/xapi-ssl.pem',
                        preinstalled_cacert,
                        '--', 'set-manager', controller])
+    # Open VxLAN IANA port to allow SDN controller to create VxLANs
+    cmd = [iptablectl, 'open', '4789', 'udp']
+    output = subprocess.Popen(cmd, stdout=subprocess.PIPE).communicate()


 def composeController(protocol, controllerIP, tcpport):
